openapi: 3.1.0
info:
  title: Payment Service API
  description: REST API for payment processing
  version: 1.0.0

servers:
  - url: http://localhost:8080
    description: Local development server

paths:
  /api/v1/payments:
    post:
      operationId: submitPayment
      summary: Submit a new payment
      tags:
        - Payments
      parameters:
        - name: Idempotency-Key
          in: header
          required: true
          schema:
            type: string
          description: Unique key to ensure idempotent processing
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentRequest'
      responses:
        '202':
          description: Payment accepted for processing
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentAcceptedResponse'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Duplicate payment (idempotency key already used)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentAcceptedResponse'
    get:
      x-spring-paginated: true
      operationId: listPayments
      summary: List payments with optional filters
      tags:
        - Payments
      parameters:
        - name: senderAccountId
          in: query
          required: false
          schema:
            type: string
            format: uuid
        - name: status
          in: query
          required: false
          schema:
            $ref: '#/components/schemas/PaymentStatus'
        - name: page
          in: query
          required: false
          schema:
            type: integer
            default: 0
        - name: size
          in: query
          required: false
          schema:
            type: integer
            default: 20
        - name: sort
          in: query
          required: false
          schema:
            type: string
      responses:
        '200':
          description: List of payments
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentListResponse'

  /api/v1/payments/{paymentId}:
    get:
      operationId: getPayment
      summary: Get payment by ID
      tags:
        - Payments
      parameters:
        - name: paymentId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Payment details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentResponse'
        '404':
          description: Payment not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/accounts:
    post:
      operationId: createAccount
      summary: Create a new account
      tags:
        - Accounts
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AccountRequest'
      responses:
        '201':
          description: Account created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccountResponse'

  /api/v1/accounts/{accountId}:
    get:
      operationId: getAccount
      summary: Get account
      tags:
        - Accounts
      parameters:
        - name: accountId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Account
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccountResponse'
        '404':
          description: Account not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    PaymentRequest:
      type: object
      required:
        - senderAccountId
        - receiverAccountId
        - amount
        - currency
      properties:
        senderAccountId:
          type: string
          format: uuid
        receiverAccountId:
          type: string
          format: uuid
        amount:
          type: string
          pattern: '^\d+(\.\d{1,2})?$'
          example: "150.00"
        currency:
          type: string
          minLength: 3
          maxLength: 3
          example: EUR

    PaymentAcceptedResponse:
      type: object
      required:
        - paymentId
        - status
      properties:
        paymentId:
          type: string
          format: uuid
        status:
          $ref: '#/components/schemas/PaymentStatus'
        message:
          type: string

    PaymentResponse:
      type: object
      required:
        - paymentId
        - senderAccountId
        - receiverAccountId
        - amount
        - currency
        - status
        - createdAt
      properties:
        paymentId:
          type: string
          format: uuid
        senderAccountId:
          type: string
          format: uuid
        receiverAccountId:
          type: string
          format: uuid
        amount:
          type: string
        currency:
          type: string
        status:
          $ref: '#/components/schemas/PaymentStatus'
        errorCode:
          type: string
        errorMessage:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    PaymentListResponse:
      type: object
      required:
        - content
        - page
        - size
        - totalElements
        - totalPages
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/PaymentResponse'
        page:
          type: integer
        size:
          type: integer
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer

    PaymentStatus:
      type: string
      enum:
        - PENDING
        - PROCESSING
        - COMPLETED
        - FAILED

    AccountRequest:
      type: object
      required:
        - balance
        - currency
      properties:
        accountId:
          type: string
          format: uuid
          description: Optional - will be generated if not provided
        balance:
          type: string
          pattern: '^\d+(\.\d{1,2})?$'
          example: "1000.00"
        currency:
          type: string
          minLength: 3
          maxLength: 3
          example: EUR

    AccountResponse:
      type: object
      required:
        - accountId
        - balance
        - currency
      properties:
        accountId:
          type: string
          format: uuid
        balance:
          type: string
        currency:
          type: string

    ErrorResponse:
      type: object
      required:
        - timestamp
        - status
        - error
        - message
        - path
        - errorCode
        - numericCode
      properties:
        timestamp:
          type: string
          format: date-time
        status:
          type: integer
        error:
          type: string
        errorCode:
          type: string
          description: Machine-readable error code
        numericCode:
          type: integer
          description: Numeric error code for programmatic handling
        message:
          type: string
        path:
          type: string
